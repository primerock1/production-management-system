# Пояснения по коду фронтенда

## Обзор архитектуры

Фронтенд построен по модульной архитектуре с разделением ответственности:
- **index.html** - структура и разметка
- **css/style.css** - стили и дизайн
- **js/api.js** - работа с REST API
- **js/modals.js** - модальные окна
- **js/app.js** - основная логика приложения

## Файл: frontend/index.html

### Структура документа
```html
<!DOCTYPE html>
<html lang="ru">
```
- Используется HTML5 с русской локализацией
- Семантическая разметка для лучшей доступности

### Подключение зависимостей
```html
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
```
- **Bootstrap 5.3** - для адаптивной сетки и компонентов UI
- **Font Awesome 6.4** - для иконок
- **Google Fonts Inter** - для современной типографики

### Навигационная панель
```html
<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
        <a class="navbar-brand" href="#">
            <img src="logo.png" alt="Logo" class="navbar-logo me-2">
            Система управления производством
        </a>
```

**Особенности:**
- Адаптивная навигация с коллапсом на мобильных
- Корпоративный логотип с правильным позиционированием
- Выпадающее меню "Справочники" для группировки связанных разделов

### Структура разделов
```html
<div id="dashboard-section" class="content-section">
<div id="material-types-section" class="content-section" style="display: none;">
```

**Принцип работы:**
- Все разделы имеют класс `content-section`
- По умолчанию скрыты (`display: none`), кроме панели управления
- Переключение через JavaScript функцию `showSection()`

### Кликабельные карточки статистики
```html
<div class="card bg-primary text-white stats-card clickable-card" 
     onclick="showSection('material-types')" 
     style="cursor: pointer;">
```

**Реализация:**
- Обработчик `onclick` для навигации
- CSS класс `clickable-card` для hover эффектов
- Цветовое кодирование карточек (primary, success, warning, info)

### Таблицы данных
```html
<div class="table-responsive">
    <table class="table table-striped" id="material-types-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Название</th>
                <th>Процент потерь (%)</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>
```

**Особенности:**
- `table-responsive` для горизонтальной прокрутки на мобильных
- Пустой `tbody` - заполняется через JavaScript
- Колонка "Действия" для кнопок редактирования/удаления

### Раздел калькулятора
```html
<div id="calculator-section" class="content-section" style="display: none;">
    <div class="row">
        <div class="col-md-6">
            <!-- Форма расчета -->
        </div>
        <div class="col-md-6">
            <!-- Результат расчета -->
        </div>
    </div>
</div>
```

**Структура:**
- Двухколоночная компоновка (форма + результат)
- Адаптивная сетка Bootstrap
- Валидация HTML5 с атрибутами `required`, `min`, `step`

## Файл: frontend/css/style.css

### CSS переменные
```css
:root {
    --primary-color: #1e3a8a;      /* Темно-синий */
    --secondary-color: #3b82f6;    /* Синий */
    --accent-color: #f59e0b;       /* Оранжевый */
    --success-color: #10b981;      /* Зеленый */
    --light-bg: #f8fafc;          /* Светло-серый фон */
}
```

**Преимущества:**
- Централизованное управление цветами
- Легкость изменения темы
- Консистентность дизайна

### Градиентные фоны
```css
body {
    background: linear-gradient(135deg, var(--light-bg) 0%, #e2e8f0 100%);
}

.navbar {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%) !important;
}
```

**Эффект:**
- Современный внешний вид
- Плавные переходы цветов
- Корпоративный стиль

### Анимации и переходы
```css
.content-section {
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
```

**Реализация:**
- Плавное появление разделов
- Микро-анимации для лучшего UX
- CSS transforms для производительности

### Hover эффекты для карточек
```css
.clickable-card:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2) !important;
}
```

**Детали:**
- Поднятие карточки при наведении
- Увеличение масштаба для акцента
- Усиленная тень для глубины

### Адаптивные стили
```css
@media (max-width: 768px) {
    .page-title {
        font-size: 1.5rem;
    }
    
    .stats-card h4 {
        font-size: 2rem;
    }
}
```

**Подход:**
- Mobile-first дизайн
- Прогрессивное улучшение
- Оптимизация для touch-устройств

## Файл: frontend/js/api.js

### Класс API
```javascript
class API {
    constructor(baseUrl) {
        this.baseUrl = baseUrl;
    }

    async request(endpoint, options = {}) {
        const url = `${this.baseUrl}${endpoint}`;
        const config = {
            headers: {
                'Content-Type': 'application/json',
                ...options.headers
            },
            ...options
        };
```

**Архитектура:**
- Единый класс для всех HTTP запросов
- Централизованная обработка ошибок
- Автоматическая установка заголовков

### Обработка ошибок
```javascript
try {
    const response = await fetch(url, config);
    
    if (!response.ok) {
        const errorData = await response.json().catch(() => ({}));
        throw new Error(errorData.detail || `HTTP error! status: ${response.status}`);
    }

    return await response.json();
} catch (error) {
    console.error('API request failed:', error);
    throw error;
}
```

**Стратегия:**
- Проверка статуса ответа
- Извлечение детальной информации об ошибке
- Логирование для отладки
- Проброс ошибки для обработки в UI

### Специализированные API модули
```javascript
const materialTypesAPI = {
    getAll: () => api.get('/material-types'),
    getById: (id) => api.get(`/material-types/${id}`),
    create: (data) => api.post('/material-types', data),
    update: (id, data) => api.put(`/material-types/${id}`, data),
    delete: (id) => api.delete(`/material-types/${id}`)
};
```

**Паттерн:**
- Объектно-ориентированный подход
- CRUD операции для каждой сущности
- Консистентные имена методов

### API калькулятора
```javascript
const calculatorAPI = {
    calculateMaterial: (data) => api.post('/calculator/calculate-material', data),
    getWorkshopsForProduct: (productId) => api.get(`/calculator/workshops-for-product/${productId}`),
    getTotalProductionTime: (productId) => api.get(`/calculator/total-production-time/${productId}`)
};
```

**Особенности:**
- Специализированные методы для бизнес-логики
- Типизированные параметры
- Асинхронные операции

## Файл: frontend/js/modals.js

### Динамическое создание модальных окон
```javascript
function createModal(id, title, bodyContent, footerContent = '') {
    const modalHTML = `
        <div class="modal fade" id="${id}" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">${title}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">${bodyContent}</div>
                    <div class="modal-footer">${footerContent}</div>
                </div>
            </div>
        </div>
    `;
```

**Подход:**
- Программное создание HTML
- Параметризованные шаблоны
- Переиспользуемые компоненты

### Формы с валидацией
```javascript
function createMaterialTypeForm(materialType = null) {
    const isEdit = materialType !== null;
    return `
        <form id="material-type-form">
            <div class="mb-3">
                <label for="material-name" class="form-label">Название материала *</label>
                <input type="text" class="form-control" id="material-name" 
                       value="${isEdit ? materialType.name : ''}" required>
            </div>
            <div class="mb-3">
                <label for="material-loss" class="form-label">Процент потерь (%) *</label>
                <input type="number" class="form-control" id="material-loss" 
                       value="${isEdit ? materialType.loss_percentage : ''}" 
                       step="0.01" min="0" max="100" required>
            </div>
        </form>
    `;
}
```

**Валидация:**
- HTML5 атрибуты (`required`, `min`, `max`, `step`)
- Автозаполнение для режима редактирования
- Типизированные поля ввода

### Загрузка данных для выпадающих списков
```javascript
async function loadProductTypeOptions() {
    try {
        const productTypes = await productTypesAPI.getAll();
        return productTypes.map(type => 
            `<option value="${type.id}">${type.name}</option>`
        ).join('');
    } catch (error) {
        console.error('Ошибка загрузки типов продукции:', error);
        return '<option value="">Ошибка загрузки данных</option>';
    }
}
```

**Стратегия:**
- Асинхронная загрузка справочных данных
- Обработка ошибок загрузки
- Генерация HTML опций

## Файл: frontend/js/app.js

### Управление состоянием приложения
```javascript
let currentSection = 'dashboard';
let cachedData = {
    materialTypes: null,
    productTypes: null,
    workshops: null,
    products: null
};
```

**Подход:**
- Глобальное состояние для текущего раздела
- Кэширование данных для производительности
- Минимизация запросов к API

### Функция переключения разделов
```javascript
async function showSection(sectionName) {
    // Скрываем все секции
    document.querySelectorAll('.content-section').forEach(section => {
        section.style.display = 'none';
    });
    
    // Показываем выбранную секцию
    const targetSection = document.getElementById(`${sectionName}-section`);
    if (targetSection) {
        targetSection.style.display = 'block';
        targetSection.classList.add('fade-in');
        currentSection = sectionName;
        
        // Обновляем навигацию
        updateNavigation(sectionName);
        
        // Загружаем данные для секции
        await loadSectionData(sectionName);
    }
}
```

**Логика:**
- Скрытие всех разделов
- Показ целевого раздела
- Обновление навигации
- Ленивая загрузка данных

### Загрузка данных с кэшированием
```javascript
async function loadMaterialTypes() {
    try {
        if (!cachedData.materialTypes) {
            cachedData.materialTypes = await materialTypesAPI.getAll();
        }
        
        const tableBody = document.querySelector('#material-types-table tbody');
        tableBody.innerHTML = '';
        
        cachedData.materialTypes.forEach(materialType => {
            const row = createMaterialTypeRow(materialType);
            tableBody.appendChild(row);
        });
    } catch (error) {
        apiUtils.handleError(error, 'при загрузке типов материалов');
    }
}
```

**Оптимизация:**
- Кэширование для избежания повторных запросов
- Очистка таблицы перед заполнением
- Создание строк через функции-фабрики

### Создание строк таблицы
```javascript
function createMaterialTypeRow(materialType) {
    const row = document.createElement('tr');
    row.innerHTML = `
        <td>${materialType.id}</td>
        <td><strong>${materialType.name}</strong></td>
        <td><span class="badge bg-warning">${materialType.loss_percentage}%</span></td>
        <td>
            <button class="btn btn-sm btn-outline-primary me-2" 
                    onclick="showEditMaterialTypeModal(${materialType.id})">
                <i class="fas fa-edit"></i> Редактировать
            </button>
            <button class="btn btn-sm btn-outline-danger" 
                    onclick="deleteMaterialType(${materialType.id})">
                <i class="fas fa-trash"></i> Удалить
            </button>
        </td>
    `;
    return row;
}
```

**Особенности:**
- Программное создание DOM элементов
- Встроенные обработчики событий
- Bootstrap классы для стилизации
- Font Awesome иконки

### CRUD операции
```javascript
async function deleteMaterialType(id) {
    if (!confirm('Вы уверены, что хотите удалить этот тип материала?')) {
        return;
    }
    
    try {
        await materialTypesAPI.delete(id);
        
        // Обновляем кэш
        if (cachedData.materialTypes) {
            cachedData.materialTypes = cachedData.materialTypes.filter(item => item.id !== id);
        }
        
        // Перезагружаем таблицу
        await loadMaterialTypes();
        
        showToast('Тип материала успешно удален', 'success');
    } catch (error) {
        apiUtils.handleError(error, 'при удалении типа материала');
    }
}
```

**Безопасность:**
- Подтверждение перед удалением
- Обновление кэша после операции
- Обратная связь через уведомления
- Обработка ошибок

### Система уведомлений
```javascript
function showToast(message, type = 'info') {
    const toastContainer = document.getElementById('toast-container');
    const toastId = 'toast-' + Date.now();
    
    const toastHTML = `
        <div class="toast align-items-center text-white bg-${type === 'error' ? 'danger' : type} border-0" 
             id="${toastId}" role="alert">
            <div class="d-flex">
                <div class="toast-body">
                    <i class="fas fa-${getToastIcon(type)} me-2"></i>
                    ${message}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" 
                        data-bs-dismiss="toast"></button>
            </div>
        </div>
    `;
    
    toastContainer.insertAdjacentHTML('beforeend', toastHTML);
    
    const toastElement = document.getElementById(toastId);
    const toast = new bootstrap.Toast(toastElement, { delay: 5000 });
    toast.show();
}
```

**UX особенности:**
- Автоматическое позиционирование
- Цветовое кодирование по типу
- Иконки для быстрого распознавания
- Автоматическое скрытие через 5 секунд

### Калькулятор сырья
```javascript
async function loadCalculatorData() {
    try {
        // Загружаем типы продукции
        const productTypes = await productTypesAPI.getAll();
        const productTypeSelect = document.getElementById('calc-product-type');
        productTypeSelect.innerHTML = '<option value="">Выберите тип продукции</option>';
        productTypes.forEach(type => {
            productTypeSelect.innerHTML += `<option value="${type.id}">${type.name} (коэф. ${type.coefficient})</option>`;
        });

        // Загружаем типы материалов
        const materialTypes = await materialTypesAPI.getAll();
        const materialTypeSelect = document.getElementById('calc-material-type');
        materialTypeSelect.innerHTML = '<option value="">Выберите тип материала</option>';
        materialTypes.forEach(type => {
            materialTypeSelect.innerHTML += `<option value="${type.id}">${type.name} (потери ${type.loss_percentage}%)</option>`;
        });
    } catch (error) {
        console.error('Ошибка загрузки данных для калькулятора:', error);
        showToast('Ошибка загрузки данных для калькулятора', 'error');
    }
}
```

**Функциональность:**
- Загрузка справочных данных
- Отображение дополнительной информации в опциях
- Обработка ошибок загрузки

### Обработка формы калькулятора
```javascript
form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = {
        product_type_id: parseInt(document.getElementById('calc-product-type').value),
        material_type_id: parseInt(document.getElementById('calc-material-type').value),
        quantity: parseInt(document.getElementById('calc-quantity').value),
        param1: parseFloat(document.getElementById('calc-param1').value),
        param2: parseFloat(document.getElementById('calc-param2').value)
    };

    try {
        const result = await calculatorAPI.calculateMaterial(formData);
        displayCalculationResult(result);
    } catch (error) {
        console.error('Ошибка расчета:', error);
        showToast('Ошибка при расчете сырья: ' + error.message, 'error');
    }
});
```

**Обработка:**
- Предотвращение стандартной отправки формы
- Типизация данных (parseInt, parseFloat)
- Асинхронный вызов API
- Отображение результата или ошибки

## Принципы разработки

### 1. Модульность
- Разделение кода по файлам и функциям
- Слабая связанность между модулями
- Переиспользуемые компоненты

### 2. Производительность
- Кэширование данных
- Ленивая загрузка
- Минимизация DOM операций

### 3. UX/UI
- Отзывчивый интерфейс
- Понятные уведомления
- Плавные анимации

### 4. Безопасность
- Валидация на клиенте и сервере
- Подтверждение критических операций
- Обработка ошибок

### 5. Доступность
- Семантическая разметка
- ARIA атрибуты
- Клавиатурная навигация

Этот код обеспечивает современный, производительный и удобный веб-интерфейс для системы управления производством.